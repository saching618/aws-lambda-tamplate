service:
  name:  ${file(config.json):LAMBDA_NAME}

plugins:
  - serverless-webpack

provider:
  name:  ${file(config.json):PROVIDER_NAME}
  region: ${file(config.json):REGION}
  runtime: ${file(config.json):RUNTIME}
  role: ${file(config.json):ROLE}
  apiGateway:
    restApiId: ${file(config.json):REST_API_ID}       #2av5qbq0pj(qa)     
    restApiRootResourceId: ${file(config.json):REST_API_ROOT_RESOURCE_ID}  # Root resource, represent as / path
    # websocketApiId: xxxxxxxxxx # Websocket API resource ID. Default is generated by the framework
    description: QA API GATEWAY # optional - description of deployment history

  stage: ${file(config.json):STAGE}
  environment:
    ENVIRONMENT: ${file(config.json):STAGE}
    AUTH_PERMISSION: ${file(config.json):AUTH_PERMISSION}
    REDIS_HOST: ${file(config.json):REDIS_HOST}
    REDIS_PORT: ${file(config.json):REDIS_PORT}
    REDIS_DB: ${file(config.json):REDIS_DB}
    REDIS_RECONNECT: ${file(config.json):REDIS_RECONNECT}

functions:
  hello:
    handler: handler.hello
    timeout: 30
    vpc:
      securityGroupIds:
        - ${file(config.json):SECURITY_GROUP_ID_1}
        - ${file(config.json):SECURITY_GROUP_ID_2}
      subnetIds:
        - ${file(config.json):SUBNET_ID_1}
        - ${file(config.json):SUBNET_ID_2}
        - ${file(config.json):SUBNET_ID_3}
    events:
      - http:
          path: test
          method: GET

  redisset:
    handler: lambda/redisset.handler
    timeout: 30
    vpc:
      securityGroupIds:
        - ${file(config.json):SECURITY_GROUP_ID_1}
        - ${file(config.json):SECURITY_GROUP_ID_2}
      subnetIds:
        - ${file(config.json):SUBNET_ID_1}
        - ${file(config.json):SUBNET_ID_2}
        - ${file(config.json):SUBNET_ID_3}
    events:
      - http:
          path: set
          method: POST
  
  redisget:
    handler: lambda/redisget.handler
    timeout: 30
    vpc:
      securityGroupIds:
        - ${file(config.json):SECURITY_GROUP_ID_1}
        - ${file(config.json):SECURITY_GROUP_ID_2}
      subnetIds:
        - ${file(config.json):SUBNET_ID_1}
        - ${file(config.json):SUBNET_ID_2}
        - ${file(config.json):SUBNET_ID_3}
    events:
      - http:
          path: get
          method: GET

  redisdel:
    handler: lambda/redisdel.handler
    timeout: 30
    vpc:
      securityGroupIds:
        - ${file(config.json):SECURITY_GROUP_ID_1}
        - ${file(config.json):SECURITY_GROUP_ID_2}
      subnetIds:
        - ${file(config.json):SUBNET_ID_1}
        - ${file(config.json):SUBNET_ID_2}
        - ${file(config.json):SUBNET_ID_3}
    events:
      - http:
          path: del
          method: DELETE
